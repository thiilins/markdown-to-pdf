/**
 * Mapa de caracteres para transliteração. Construído uma única vez para performance.
 * Chaves são os caracteres a serem substituídos, valores são seus equivalentes ASCII.
 */
const characterMap: Record<string, string> = {
  ' ': '-',
  à: 'a',
  á: 'a',
  ả: 'a',
  ã: 'a',
  ạ: 'a',
  ă: 'a',
  ắ: 'a',
  ằ: 'a',
  ẳ: 'a',
  ẵ: 'a',
  ặ: 'a',
  â: 'a',
  ấ: 'a',
  ầ: 'a',
  ẩ: 'a',
  ẫ: 'a',
  ậ: 'a',
  ā: 'a',
  ą: 'a',
  å: 'a',
  α: 'a',
  ά: 'a',
  ἀ: 'a',
  ἁ: 'a',
  ἂ: 'a',
  ἃ: 'a',
  ἄ: 'a',
  ἅ: 'a',
  ἆ: 'a',
  ἇ: 'a',
  ᾀ: 'a',
  ᾁ: 'a',
  ᾂ: 'a',
  ᾃ: 'a',
  ᾄ: 'a',
  ᾅ: 'a',
  ᾆ: 'a',
  ᾇ: 'a',
  ὰ: 'a',
  ᾰ: 'a',
  ᾱ: 'a',
  ᾲ: 'a',
  ᾳ: 'a',
  ᾴ: 'a',
  ᾶ: 'a',
  ᾷ: 'a',
  а: 'a',
  أ: 'a',
  အ: 'a',
  'ာ': 'a',
  'ါ': 'a',
  ǻ: 'a',
  ǎ: 'a',
  ª: 'a',
  ა: 'a',
  अ: 'a',
  ا: 'a',
  ａ: 'a',
  ä: 'ae',
  б: 'b',
  β: 'b',
  ب: 'b',
  ဗ: 'b',
  ბ: 'b',
  ｂ: 'b',
  ç: 'c',
  ć: 'c',
  č: 'c',
  ĉ: 'c',
  ċ: 'c',
  ｃ: 'c',
  ď: 'd',
  ð: 'd',
  đ: 'd',
  ƌ: 'd',
  ȡ: 'd',
  ɖ: 'd',
  ɗ: 'd',
  ᵭ: 'd',
  ᶁ: 'd',
  ᶑ: 'd',
  д: 'd',
  δ: 'd',
  د: 'd',
  ض: 'd',
  ဍ: 'd',
  ဒ: 'd',
  დ: 'd',
  ｄ: 'd',
  é: 'e',
  è: 'e',
  ẻ: 'e',
  ẽ: 'e',
  ẹ: 'e',
  ê: 'e',
  ế: 'e',
  ề: 'e',
  ể: 'e',
  ễ: 'e',
  ệ: 'e',
  ë: 'e',
  ē: 'e',
  ę: 'e',
  ě: 'e',
  ĕ: 'e',
  ė: 'e',
  ε: 'e',
  έ: 'e',
  ἐ: 'e',
  ἑ: 'e',
  ἒ: 'e',
  ἓ: 'e',
  ἔ: 'e',
  ἕ: 'e',
  ὲ: 'e',
  е: 'e',
  ё: 'e',
  э: 'e',
  є: 'e',
  ə: 'e',
  ဧ: 'e',
  'ေ': 'e',
  'ဲ': 'e',
  ე: 'e',
  ए: 'e',
  إ: 'e',
  ئ: 'e',
  ｅ: 'e',
  ф: 'f',
  φ: 'f',
  ف: 'f',
  ƒ: 'f',
  ფ: 'f',
  ｆ: 'f',
  ĝ: 'g',
  ğ: 'g',
  ġ: 'g',
  ģ: 'g',
  г: 'g',
  ґ: 'g',
  γ: 'g',
  ဂ: 'g',
  გ: 'g',
  گ: 'g',
  ｇ: 'g',
  ĥ: 'h',
  ħ: 'h',
  η: 'h',
  ή: 'h',
  ح: 'h',
  ه: 'h',
  ဟ: 'h',
  'ှ': 'h',
  ჰ: 'h',
  ｈ: 'h',
  í: 'i',
  ì: 'i',
  ỉ: 'i',
  ĩ: 'i',
  ị: 'i',
  î: 'i',
  ï: 'i',
  ī: 'i',
  ĭ: 'i',
  į: 'i',
  ı: 'i',
  ι: 'i',
  ί: 'i',
  ϊ: 'i',
  ΐ: 'i',
  ἰ: 'i',
  ἱ: 'i',
  ἲ: 'i',
  ἳ: 'i',
  ἴ: 'i',
  ἵ: 'i',
  ἶ: 'i',
  ἷ: 'i',
  ὶ: 'i',
  ῐ: 'i',
  ῑ: 'i',
  ῒ: 'i',
  ῖ: 'i',
  ῗ: 'i',
  і: 'i',
  ї: 'i',
  и: 'i',
  ဣ: 'i',
  'ိ': 'i',
  'ီ': 'i',
  ည်: 'i',
  ǐ: 'i',
  ი: 'i',
  इ: 'i',
  ی: 'i',
  ｉ: 'i',
  ĵ: 'j',
  ј: 'j',
  Ј: 'j',
  ჯ: 'j',
  ج: 'j',
  ｊ: 'j',
  ķ: 'k',
  ĸ: 'k',
  к: 'k',
  κ: 'k',
  Ķ: 'k',
  ق: 'k',
  ك: 'k',
  က: 'k',
  კ: 'k',
  ქ: 'k',
  ک: 'k',
  ｋ: 'k',
  ł: 'l',
  ľ: 'l',
  ĺ: 'l',
  ļ: 'l',
  ŀ: 'l',
  л: 'l',
  λ: 'l',
  ل: 'l',
  လ: 'l',
  ლ: 'l',
  ｌ: 'l',
  м: 'm',
  μ: 'm',
  م: 'm',
  မ: 'm',
  მ: 'm',
  ｍ: 'm',
  ñ: 'n',
  ń: 'n',
  ň: 'n',
  ņ: 'n',
  ŉ: 'n',
  ŋ: 'n',
  ν: 'n',
  н: 'n',
  ن: 'n',
  န: 'n',
  ნ: 'n',
  ｎ: 'n',
  ó: 'o',
  ò: 'o',
  ỏ: 'o',
  õ: 'o',
  ọ: 'o',
  ô: 'o',
  ố: 'o',
  ồ: 'o',
  ổ: 'o',
  ỗ: 'o',
  ộ: 'o',
  ơ: 'o',
  ớ: 'o',
  ờ: 'o',
  ở: 'o',
  ỡ: 'o',
  ợ: 'o',
  ø: 'o',
  ō: 'o',
  ő: 'o',
  ŏ: 'o',
  ο: 'o',
  ὀ: 'o',
  ὁ: 'o',
  ὂ: 'o',
  ὃ: 'o',
  ὄ: 'o',
  ὅ: 'o',
  ὸ: 'o',
  ό: 'o',
  о: 'o',
  و: 'o',
  θ: 'o',
  'ို': 'o',
  ǒ: 'o',
  ǿ: 'o',
  º: 'o',
  ო: 'o',
  ओ: 'o',
  ｏ: 'o',
  ö: 'oe',
  п: 'p',
  π: 'p',
  ပ: 'p',
  პ: 'p',
  پ: 'p',
  ｐ: 'p',
  ყ: 'q',
  ｑ: 'q',
  ŕ: 'r',
  ř: 'r',
  ŗ: 'r',
  р: 'r',
  ρ: 'r',
  ر: 'r',
  რ: 'r',
  ｒ: 'r',
  ś: 's',
  š: 's',
  ş: 's',
  с: 's',
  σ: 's',
  ș: 's',
  ς: 's',
  س: 's',
  ص: 's',
  စ: 's',
  ſ: 's',
  ს: 's',
  ｓ: 's',
  ť: 't',
  ţ: 't',
  т: 't',
  τ: 't',
  ț: 't',
  ت: 't',
  ط: 't',
  ဋ: 't',
  တ: 't',
  ŧ: 't',
  თ: 't',
  ტ: 't',
  ｔ: 't',
  ú: 'u',
  ù: 'u',
  ủ: 'u',
  ũ: 'u',
  ụ: 'u',
  ư: 'u',
  ứ: 'u',
  ừ: 'u',
  ử: 'u',
  ữ: 'u',
  ự: 'u',
  û: 'u',
  ū: 'u',
  ů: 'u',
  ű: 'u',
  ŭ: 'u',
  ų: 'u',
  µ: 'u',
  у: 'u',
  ဉ: 'u',
  'ု': 'u',
  'ူ': 'u',
  ǔ: 'u',
  ǖ: 'u',
  ǘ: 'u',
  ǚ: 'u',
  ǜ: 'u',
  უ: 'u',
  उ: 'u',
  ｕ: 'u',
  ў: 'u',
  ü: 'ue',
  в: 'v',
  ვ: 'v',
  ϐ: 'v',
  ｖ: 'v',
  ŵ: 'w',
  ω: 'w',
  ώ: 'w',
  ဝ: 'w',
  'ွ': 'w',
  ｗ: 'w',
  χ: 'x',
  ξ: 'x',
  ｘ: 'x',
  ý: 'y',
  ỳ: 'y',
  ỷ: 'y',
  ỹ: 'y',
  ỵ: 'y',
  ÿ: 'y',
  ŷ: 'y',
  й: 'y',
  ы: 'y',
  υ: 'y',
  ϋ: 'y',
  ύ: 'y',
  ΰ: 'y',
  ي: 'y',
  ယ: 'y',
  ｙ: 'y',
  ź: 'z',
  ž: 'z',
  ż: 'z',
  з: 'z',
  ζ: 'z',
  ز: 'z',
  ဇ: 'z',
  ზ: 'z',
  ｚ: 'z',
  ع: 'aa',
  आ: 'aa',
  آ: 'aa',
  æ: 'ae',
  ǽ: 'ae',
  ऐ: 'ai',
  ч: 'ch',
  ჩ: 'ch',
  ჭ: 'ch',
  چ: 'ch',
  ђ: 'dj',
  џ: 'dz',
  ძ: 'dz',
  ऍ: 'ei',
  غ: 'gh',
  ღ: 'gh',
  ई: 'ii',
  ĳ: 'ij',
  х: 'kh',
  خ: 'kh',
  ხ: 'kh',
  љ: 'lj',
  њ: 'nj',
  œ: 'oe',
  ؤ: 'oe',
  ऑ: 'oi',
  ऒ: 'oii',
  ψ: 'ps',
  ш: 'sh',
  შ: 'sh',
  ش: 'sh',
  щ: 'shch',
  ß: 'ss',
  ŝ: 'sx',
  þ: 'th',
  ϑ: 'th',
  ث: 'th',
  ذ: 'th',
  ظ: 'th',
  ц: 'ts',
  ც: 'ts',
  წ: 'ts',
  ऊ: 'uu',
  я: 'ya',
  ю: 'yu',
  ж: 'zh',
  ჟ: 'zh',
  ژ: 'zh',
  '©': '(c)',
  '’': "'",
  '“': '"',
  '”': '"',
  '‘': "'",
  '–': '-',
  '—': '-',
  '&': '-e-',
  _: '-',
  ',': '-',
  ':': '-',
  ';': '-',
}

/**
 * Converte uma string de texto em um "slug" amigável para URLs, com suporte
 * extensivo a caracteres internacionais através de transliteração.
 *
 * @param str - A string de entrada a ser convertida.
 * @returns A string formatada como um slug.
 */
export const slugify = (str: string): string => {
  if (typeof str !== 'string' || !str) return ''

  // 1. Normaliza para minúsculas e remove espaços no início/fim.
  const s = str.toLowerCase().trim()
  let result = ''

  // 2. Otimização de Performance: Itera pela string uma única vez para transliteração.
  for (let i = 0; i < s.length; i++) {
    const char = s[i]
    result += characterMap[char] || char
  }

  // 3. Etapa final de limpeza com RegEx.
  return result
    .replace(/[^a-z0-9 -]/g, '') // Remove caracteres inválidos restantes.
    .replace(/\s+/g, '-') // Agrupa espaços e substitui por hífen.
    .replace(/-+/g, '-') // Agrupa hífens.
}
